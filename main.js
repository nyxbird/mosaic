let canvas, ctx, board;
let height, width;
let hex;

let locs2 = [
    [2,10],[2,11],
    [3,8],[3,9],[3,10],[3,11],
    [4,11],[4,12],[4,13],[4,15],[4,16],[4,19],[4,20],[4,21],[4,22],[4,24],
    [5,8],[5,9],[5,10],[5,12],[5,13],[5,14],[5,15],[5,16],[5,17],[5,18],[5,19],[5,20],[5,21],[5,22],[5,23],[5,24],
    [6,8],[6,9],[6,14],[6,17],[6,19],[6,20],[6,22],[6,23],[6,24],
    [7,8],[7,12],[7,15],[7,17],[7,18],[7,19],[7,20],[7,21],[7,22],[7,23],
    [8,1],[8,3],[8,5],[8,7],[8,10],[8,11],[8,16],[8,17],[8,18],[8,24],
    [9,1],[9,2],[9,4],[9,5],[9,7],[9,8],[9,9],[9,23],[9,24],
    [10,2],[10,4],[10,6],[10,7],[10,9],[10,23],
    [11,15],[11,17],[11,19],[11,21],[11,22],[11,24],
    [12,15],[12,17],[12,18],[12,19],[12,20],[12,22],[12,23],[12,24],
    [13,16],[13,17],[13,19],[13,20],[13,21],[13,22]
];

let locs3 = [
    [0,3],[0,4],[0,6],[0,7],[0,8],
    [1,4],[1,5],[1,6],[1,8],
    [2,4],[2,5],[2,6],[2,7],[2,8],[2,10],[2,11],
    [3,5],[3,7],[3,8],[3,9],[3,10],[3,11],
    [4,11],[4,12],[4,13],[4,15],[4,16],[4,19],[4,20],[4,21],[4,22],[4,24],
    [5,8],[5,9],[5,10],[5,12],[5,13],[5,14],[5,15],[5,16],[5,17],[5,18],[5,19],[5,20],[5,21],[5,22],[5,23],[5,24],
    [6,8],[6,9],[6,14],[6,17],[6,19],[6,20],[6,22],[6,23],[6,24],
    [7,8],[7,12],[7,15],[7,17],[7,18],[7,19],[7,20],[7,21],[7,22],[7,23],
    [8,1],[8,3],[8,5],[8,7],[8,10],[8,11],[8,16],[8,17],[8,18],[8,24],
    [9,1],[9,2],[9,4],[9,5],[9,7],[9,8],[9,9],[9,23],[9,24],
    [10,2],[10,4],[10,6],[10,7],[10,9],[10,23],
    [11,15],[11,17],[11,19],[11,21],[11,22],[11,24],
    [12,15],[12,17],[12,18],[12,19],[12,20],[12,22],[12,23],[12,24],
    [13,16],[13,17],[13,19],[13,20],[13,21],[13,22]
];

let locs4 = [
    [0,3],[0,4],[0,6],[0,7],[0,8],
    [1,4],[1,5],[1,6],[1,8],
    [2,4],[2,5],[2,6],[2,7],[2,8],[2,10],[2,11],
    [3,0],[3,1],[3,2],[3,3],[3,5],[3,7],[3,8],[3,9],[3,10],[3,11],
    [4,0],[4,1],[4,3],[4,4],[4,5],[4,11],[4,12],[4,13],[4,15],[4,16],[4,19],[4,20],[4,21],[4,22],[4,24],
    [5,0],[5,1],[5,2],[5,3],[5,8],[5,9],[5,10],[5,12],[5,13],[5,14],[5,15],[5,16],[5,17],[5,18],[5,19],[5,20],[5,21],[5,22],[5,23],[5,24],
    [6,1],[6,3],[6,8],[6,9],[6,14],[6,17],[6,19],[6,20],[6,22],[6,23],[6,24],
    [7,0],[7,1],[7,2],[7,3],[7,8],[7,12],[7,15],[7,17],[7,18],[7,19],[7,20],[7,21],[7,22],[7,23],
    [8,1],[8,2],[8,3],[8,5],[8,7],[8,10],[8,11],[8,16],[8,17],[8,18],[8,24],
    [9,1],[9,2],[9,4],[9,5],[9,7],[9,8],[9,9],[9,23],[9,24],
    [10,2],[10,4],[10,6],[10,7],[10,9],[10,23],
    [11,15],[11,17],[11,19],[11,21],[11,22],[11,24],
    [12,15],[12,17],[12,18],[12,19],[12,20],[12,22],[12,23],[12,24],
    [13,16],[13,17],[13,19],[13,20],[13,21],[13,22]
];

function init() {
    canvas = document.getElementById("overlay");
    ctx = canvas.getContext("2d");
    board = document.getElementById("boardimg");
    canvas.width = board.width;
    canvas.height = board.height;
    width = canvas.width;
    height = canvas.height;
    hex = canvas.width*0.051;
}

function generate() {
    let players = document.querySelector("input[type='radio'][name=players]:checked").value;
    let locs = [locs2, locs3, locs4][players];

    ctx.clearRect(0, 0, width, height);
    let bag = [];
    for(let i = 0; i < 58; ++i) bag.push(1);
    for(let i=0;i<80;++i) bag.push(0);

    // shuffle
    for(i = bag.length; i>0; --i) {
        let r = Math.floor(Math.random()*i);
        [bag[r], bag[i-1]] = [bag[i-1], bag[r]];
    }
    
    let c = 0;
    for(let loc of locs) {
        if(bag.pop()) {add_good(...coord(...loc));++c;}
    }
}

function coord(i, j) {
    let xo = width*33/773, yo = height*126/600;
    let dx = hex*3/4, dy=hex*Math.sqrt(3)/2*0.98;
    return [xo+j*dx, yo+i*dy+(j%2?dy/2:0)];
}

function add_good(x, y) {
    ctx.beginPath();
    ctx.arc(x, y, hex/3, 0, 2*Math.PI);
    // ctx.arc(x, y, hex/6, 0, 2*Math.PI, true);
    ctx.fillStyle = "black";
    ctx.fill("evenodd");
}

addEventListener("load", init);